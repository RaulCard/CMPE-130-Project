<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Encrypto</title>
		<link rel="stylesheet" href="bootstrap.css">
		<link href = "main.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <script type="text/javascript" src="2.0.0-crypto-sha1-hmac-pbkdf2-ofb-aes.js"></script>
	</head>
	<body>
		<h1>
			AES Image Encryption Project
		</h1>

		<ul class="list-inline">
			<li class="list-inline-item"><a id="all" href="#">Show All</a></li>
			<li class="list-inline-item"><a id="user1" href="#">User 1</a></li>
			<li class="list-inline-item"><a id="user2" href="#">User 2</a></li>
			<li class="list-inline-item"><a id="user3" href="#">User 3</a></li>
			<li class="list-inline-item"><a id="user4" href="#">User 4</a></li>
		</ul>
<!--     <form id="passinput" onsubmit="return false;">
      <input type="text" id="userInput" />
      <input type="submit" onclick="othername();" />
    </form> -->
		<div class="container-fluid">
			<div class="row">
        		<div class="col-sm">
        			<canvas class="canV" id="img1" width="250" height="250"></canvas>
              <h2>Encrypted Data</h2>
              <input id="img1data" class="eData" name="encrypted" type="text" size="80" value="Image 1">
        			
              <canvas class="canV" id="img5" width="250" height="250"></canvas>
              <h2>Encrypted Data</h2>
              <input id="img5data" class="eData" name="encrypted" type="text" size="80" value="Image 5">
        		</div>
        		<div class="col-sm">
        			<canvas class="canV" id="img2" width="250" height="250"></canvas>
              <h2>Encrypted Data</h2>
              <input id="img2data" class="eData" name="encrypted" type="text" size="80" value="Image 2">

        			<canvas class="canV" id="img6" width="250" height="250"></canvas>
              <h2>Encrypted Data</h2>
              <input id="img6data" class="eData" name="encrypted" type="text" size="80" value="Image 6">

        		</div>
        		<div class="col-sm">
        			<canvas class="canV" id="img3" width="250" height="250"></canvas>
              <h2>Encrypted Data</h2>
              <input id="img3data" class="eData" name="encrypted" type="text" size="80" value="Image 3">

        			<canvas class="canV" id="img7" width="250" height="250"></canvas>
              <h2>Encrypted Data</h2>
              <input id="img7data" class="eData" name="encrypted" type="text" size="80" value="Image 7">
        		</div>
        		<div class="col-sm">
        			<canvas class="canV" id="img4" width="250" height="250"></canvas>
              <h2>Encrypted Data</h2>
              <input id="img4data" class="eData" name="encrypted" type="text" size="80" value="Image 4">

              <canvas class="canV" id="img8" width="250" height="250"></canvas>
              <h2>Encrypted Data</h2>
              <input id="img8data" class="eData" name="encrypted" type="text" size="80" value="Image 8">
        		</div>
        	</div>
		</div>
		<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
	    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
	    <script type="text/javascript" src="bootstrap.js"></script>
	    
	    <script>
        var ownershipAry = [
          [1,2],
          [5,8],
          [3,6],
          [7,4]
        ];
        var passwordAry = ["u1p","u2p","u3p","u4p"];
        var currentUser="";

	      	$(document).ready(function(){
	      	  $("#user1").click(function(){
              encryptAll();
            });
		      });
          // $(document).ready(function(){
          //   $("#user1").click(function(){
          //     decryptImg();
          //   });
          // });


        $(document).ready(function(){
          $("#user1").click(function(){
              currentUser="u1";
          });
        });
      var img1 = new Image();
      img1.src = 'img/user_images/1.jpg';

      var img2 = new Image();
      img2.src = 'img/user_images/2.jpg';

      var img3 = new Image();
      img3.src = 'img/user_images/3.jpg';

      var img4 = new Image();
      img4.src = 'img/user_images/4.jpg';

      var img5 = new Image();
      img5.src = 'img/user_images/5.jpg';

      var img6 = new Image();
      img6.src = 'img/user_images/6.jpg';

      var img7 = new Image();
      img7.src = 'img/user_images/7.jpg';

      var img8 = new Image();
      img8.src = 'img/user_images/8.jpg';

      var sImg = new Image();
      sImg.src = 'img/scrambled.png';

      var width=250;
      var height=250;
      var ctx, imgd, pix1, pix2, pix3;
      
      img1.onload = function() {
        ctx1 = document.getElementById('img1').getContext('2d');
        ctx1.drawImage(img1,0,0,250,250);

        imgd = ctx1.getImageData(0,0,width,height);
        pix = imgd.data;
      }
      img2.onload = function() {
        ctx2 = document.getElementById('img2').getContext('2d');
        ctx2.drawImage(img2,0,0,250,250);

        imgd = ctx2.getImageData(0,0,width,height);
        pix2 = imgd.data;
      }
      img3.onload = function() {
        ctx3 = document.getElementById('img3').getContext('2d');
        ctx3.drawImage(img3,0,0,250,250);

        imgd = ctx3.getImageData(0,0,width,height);
        pix3 = imgd.data;
      }
      img4.onload = function() {
        ctx4 = document.getElementById('img4').getContext('2d');
        ctx4.drawImage(img4,0,0,250,250);

        imgd = ctx4.getImageData(0,0,width,height);
        pix4 = imgd.data;
      }
      img5.onload = function() {
        ctx5 = document.getElementById('img5').getContext('2d');
        ctx5.drawImage(img5,0,0,250,250);

        imgd = ctx5.getImageData(0,0,width,height);
        pix5 = imgd.data;
      }
      img6.onload = function() {
        ctx6 = document.getElementById('img6').getContext('2d');
        ctx6.drawImage(img6,0,0,250,250);

        imgd = ctx6.getImageData(0,0,width,height);
        pix6 = imgd.data;
      }
      
      img7.onload = function() {
        ctx7 = document.getElementById('img7').getContext('2d');
        ctx7.drawImage(img7,0,0,250,250);

        imgd = ctx7.getImageData(0,0,width,height);
        pix7 = imgd.data;
      }
      img8.onload = function() {
        ctx8 = document.getElementById('img8').getContext('2d');
        ctx8.drawImage(img8,0,0,250,250);

        imgd = ctx8.getImageData(0,0,width,height);
        pix8 = imgd.data;
      }
      function clear_canvas(ctx_num) {
        ctx.clearRect(0,0,160,120);
        imgd.data=[];
      }

      function canvasArrToString(a) {
        var s="";
        // Removes alpha to save space.
        for (var i=0; i<pix.length; i+=4) {
          s+=(String.fromCharCode(pix[i]) 
              + String.fromCharCode(pix[i+1]) 
              + String.fromCharCode(pix[i+2]));
        }
        return s;
      }

      function canvasStringToArr(s) {
        var p=[];
        for (var i=0; i<s.length; i+=3) {
          for (var j=0; j<3; j++) {
            p.push(s.substring(i+j,i+j+1).charCodeAt());
          } 
          p.push(255); // Hardcodes alpha to 255.
        }
        return p;
      }

      function encryptAES(pass, imgnum) {
        var id="img"+imgnum+"data";
        var s=canvasArrToString(pix);
        var encrypted = Krypto.AES.encrypt(s, pass);
        document.getElementById(id).value=encrypted;

        var ctx_str="ctx"+imgnum;
        var ctx_tb=eval(ctx_str);
        ctx_tb.drawImage(sImg, 0, 0);
      }

      function decryptAES(pass) { //Will be run when you select a user to decrypt their images using their password.
        var arr=canvasStringToArr(Krypto.AES.decrypt(document.getElementById('ta').value, pass));
        for (var i=0; i<arr.length; i++) { arr[i]-=0; }
        pix=arr;
        imgd.data=pix;
        ctx.putImageData(imgd,0,0);
        document.getElementById('ta').value="";
      }

      function encryptAll() { //Go through each user and encrypt the images they own with their password.
        for(var i=0; i<4; i++){
          for(var j=0; j<2; j++){

            encryptAES(passwordAry[i], ownershipAry[i][j]);
            //console.log("User"+(i+1)+": "+ownershipAry[i][j]);
          }
        }
      }

      function decryptImg(){ //Decrypt images belonging to user with their private password
        for(var i=0; i<2; i++){
          decryptAES(passwordAry[0]);
        }
      }

    </script>
	</body>
</html>